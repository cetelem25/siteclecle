<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>R√©visions 2GM ‚Äì Relier</title>
<style>
  body{margin:0;background:#0f1320;color:#e9ecf1;font:15px system-ui;padding:16px}
  h1{margin:8px 0 16px}
  nav a{color:#e9ecf1;margin-right:10px;text-decoration:none;font-weight:bold}
  .btn{padding:8px 12px;background:#1b2140;border:1px solid #232a40;border-radius:8px;color:#fff;cursor:pointer;transition:0.15s;margin:6px 6px 6px 0}
  .btn:hover{filter:brightness(1.15)}
  .match-container{display:flex;flex-wrap:wrap;gap:10px;margin:16px 0}
  .match-box{background:#1c2235;padding:10px 12px;border-radius:8px;cursor:pointer;border:1px solid #232a40;user-select:none;min-width:180px}
  .match-box.selected{box-shadow:0 0 0 3px rgba(76,175,80,0.12);border-color:#4caf50}
  .match-box.correct{background:#163b22;border-color:#2e7d32;color:#eaffea}
  .match-box.wrong{background:#4a1414;border-color:#b71c1c;color:#ffdfe0}
  #matchResult{margin-top:12px;font-weight:bold}
  .note{color:#cbd5ff;font-size:13px;margin-top:8px}
  @media (max-width:720px){
    .match-box{min-width:140px;padding:8px}
  }
</style>
</head>
<body>

<h1>üîó Relier √©v√©nements et dates</h1>

<nav>
  <a href="index.html">Accueil</a> |
  <a href="qcm.html">QCM</a> |
  <a href="fill.html">Texte √† trous</a> |
  <a href="match.html">Relier</a> |
  <a href="videos.html">Vid√©os</a>
  <a href="anglais.html">Anglais</a>
</nav>

<div style="margin-top:12px">
  <button class="btn" onclick="createMatch()">G√©n√©rer / R√©initialiser</button>
  <button class="btn" onclick="revealAll()">Afficher r√©ponses</button>
  <button class="btn" onclick="shuffleAndCreate()">M√©langer</button>
</div>

<div id="matchContainer" class="match-container" aria-live="polite"></div>
<button class="btn" onclick="checkMatches()">V√©rifier</button>
<div id="matchResult"></div>
<div class="note">Clique d'abord sur un √©v√©nement (ou une date) pour le s√©lectionner, puis clique sur son correspondant. Vert = correct, rouge = incorrect.</div>

<script>
// ===== Liste compl√®te des √©v√©nements / dates =====
const eventsDates = [
  {event:"Anschluss (Autriche)", date:"13 mars 1938"},
  {event:"Conf√©rence de Munich / Sud√®tes", date:"30 septembre 1938"},
  {event:"Annexion de la Boh√™me-Moravie", date:"15 mars 1939"},
  {event:"Invasion de la Pologne", date:"1er septembre 1939"},
  {event:"France & Royaume-Uni d√©clarent la guerre", date:"3 septembre 1939"},
  {event:"Dr√¥le de guerre", date:"3 septembre 1939 - 10 mai 1940"},
  {event:"Invasion du Danemark et de la Norv√®ge", date:"9 avril 1940"},
  {event:"Offensive allemande √† l'Ouest (campagne de France)", date:"10 mai - 22 juin 1940"},
  {event:"Armistice franco-allemand", date:"22 juin 1940"},
  {event:"Bataille d'Angleterre (Blitz)", date:"Juillet - octobre 1940"},
  {event:"L'Italie envahit la Gr√®ce", date:"28 octobre 1940"},
  {event:"Op√©ration Barbarossa (invasion URSS)", date:"22 juin 1941"},
  {event:"Actions des Einsatzgruppen", date:"Juin 1941 - 1944"},
  {event:"Attaque de Pearl Harbor", date:"7 d√©cembre 1941"},
  {event:"Entr√©e en guerre des √âtats-Unis", date:"8 d√©cembre 1941"},
  {event:"Bataille de Midway", date:"4 - 7 juin 1942"},
  {event:"Bataille de Stalingrad", date:"23 ao√ªt 1942 - 2 f√©vrier 1943"},
  {event:"Bataille d'El-Alamein", date:"23 octobre - 3 novembre 1942"},
  {event:"D√©barquement en Afrique du Nord (Op√©ration Torch)", date:"8 novembre 1942"},
  {event:"Conf√©rence de T√©h√©ran", date:"28 novembre - 1er d√©cembre 1943"},
  {event:"Op√©ration Bagration", date:"22 juin - 19 ao√ªt 1944"},
  {event:"Insurrection de Varsovie", date:"1er ao√ªt - 2 octobre 1944"},
  {event:"D√©barquement de Normandie (Overlord)", date:"6 juin 1944"},
  {event:"D√©barquement de Provence", date:"15 ao√ªt 1944"},
  {event:"Lib√©ration de Paris", date:"25 ao√ªt 1944"},
  {event:"Lib√©ration de Metz", date:"22 novembre 1944"},
  {event:"Lib√©ration de Strasbourg", date:"23 novembre 1944"},
  {event:"Bataille des Ardennes", date:"16 d√©cembre 1944 - 25 janvier 1945"},
  {event:"Lib√©ration du camp d'Auschwitz", date:"27 janvier 1945"},
  {event:"Bataille de Berlin", date:"16 avril - 2 mai 1945"},
  {event:"Suicide d'Hitler", date:"30 avril 1945"},
  {event:"Capitulation de l'Allemagne (fin guerre en Europe)", date:"8 mai 1945"},
  {event:"Bombardement d'Hiroshima", date:"6 ao√ªt 1945"},
  {event:"Bombardement d'Nagasaki", date:"9 ao√ªt 1945"},
  {event:"Capitulation du Japon (fin Seconde Guerre mondiale)", date:"2 septembre 1945"}
];

// ===== Utilitaires =====
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

// ===== Matching logic =====
let selectedBox = null; // {type:'event'|'date', text, element}
let pairsState = {}; // event -> matched date (string) or null

function clearSelectionVisuals(){
  document.querySelectorAll('.match-box').forEach(el=>{
    el.classList.remove('selected');
  });
}

function createMatch(){
  selectedBox = null;
  pairsState = {};
  const container = document.getElementById('matchContainer');
  if(!container) return;
  container.innerHTML = '';

  // Use a shallow copy and shuffle
  const events = shuffle([...eventsDates.map(e=>e.event)]);
  const dates  = shuffle([...eventsDates.map(e=>e.date)]);

  // create event boxes
  events.forEach(ev=>{
    const div = document.createElement('div');
    div.className = 'match-box';
    div.dataset.type = 'event';
    div.textContent = ev;
    div.tabIndex = 0;
    div.onclick = () => handleSelect(div, ev, 'event');
    div.onkeydown = (e) => { if(e.key==='Enter') handleSelect(div, ev, 'event'); };
    container.appendChild(div);
    pairsState[ev] = null;
  });

  // create date boxes
  dates.forEach(dt=>{
    const div = document.createElement('div');
    div.className = 'match-box';
    div.dataset.type = 'date';
    div.textContent = dt;
    div.tabIndex = 0;
    div.onclick = () => handleSelect(div, dt, 'date');
    div.onkeydown = (e) => { if(e.key==='Enter') handleSelect(div, dt, 'date'); };
    container.appendChild(div);
  });

  document.getElementById('matchResult').textContent = '';
}

function handleSelect(element, text, type){
  // If nothing selected yet, mark this one
  if(!selectedBox){
    selectedBox = {type, text, element};
    clearSelectionVisuals();
    element.classList.add('selected');
    return;
  }

  // If same box clicked again -> unselect
  if(selectedBox.element === element){
    selectedBox = null;
    element.classList.remove('selected');
    return;
  }

  // If both are same type, switch selection to the new one
  if(selectedBox.type === type){
    clearSelectionVisuals();
    selectedBox = {type, text, element};
    element.classList.add('selected');
    return;
  }

  // Now we have an event and a date (order may vary)
  let eventText, dateText, eventEl, dateEl;
  if(selectedBox.type === 'event'){
    eventText = selectedBox.text; dateText = text;
    eventEl = selectedBox.element; dateEl = element;
  } else {
    eventText = text; dateText = selectedBox.text;
    eventEl = element; dateEl = selectedBox.element;
  }

  // Check correct pair
  const correctDate = eventsDates.find(e => e.event === eventText)?.date;
  if(!correctDate){
    // fallback safety
    selectedBox = null;
    clearSelectionVisuals();
    return;
  }

  if(normalize(dateText) === normalize(correctDate)){
    // Mark correct visually and lock them
    eventEl.classList.add('correct');
    dateEl.classList.add('correct');
    eventEl.onclick = null; eventEl.onkeydown = null;
    dateEl.onclick = null;  dateEl.onkeydown = null;
    pairsState[eventText] = dateText;
  } else {
    // Briefly mark wrong then revert selection (allow retry)
    dateEl.classList.add('wrong');
    eventEl.classList.add('wrong');
    setTimeout(()=>{
      dateEl.classList.remove('wrong');
      eventEl.classList.remove('wrong');
    }, 900);
  }

  selectedBox = null;
  clearSelectionVisuals();
}

function normalize(s){
  return String(s||'').trim().toLowerCase().replace(/\s+/g,' ');
}

function checkMatches(){
  const total = Object.keys(pairsState).length;
  const found = Object.values(pairsState).filter(Boolean).length;
  const res = document.getElementById('matchResult');
  if(found === total){
    res.textContent = `Bravo ‚Äî toutes les paires sont correctes ! (${found}/${total})`;
  } else {
    res.textContent = `Paires correctes : ${found}/${total} ‚Äî continue !`;
  }
}

// Reveal correct answers (fills unmatched event boxes with the correct date label)
function revealAll(){
  // For each event still unmatched, find its correct date element and mark both as correct
  const container = document.getElementById('matchContainer');
  if(!container) return;
  const boxes = [...container.querySelectorAll('.match-box')];
  const eventBoxes = boxes.filter(b => b.dataset.type === 'event');
  const dateBoxes  = boxes.filter(b => b.dataset.type === 'date');

  eventBoxes.forEach(evEl=>{
    const evText = evEl.textContent;
    const correctDate = eventsDates.find(e => e.event === evText)?.date;
    if(!correctDate) return;
    // find date box with matching normalized text
    const matchDateBox = dateBoxes.find(db => normalize(db.textContent) === normalize(correctDate));
    if(matchDateBox){
      evEl.classList.add('correct');
      matchDateBox.classList.add('correct');
      // disable clicks
      evEl.onclick = null; evEl.onkeydown = null;
      matchDateBox.onclick = null; matchDateBox.onkeydown = null;
      pairsState[evText] = correctDate;
    }
  });

  checkMatches();
}

function shuffleAndCreate(){
  // shuffle the source eventsDates order (doesn't matter much since createMatch shuffles), then recreate
  shuffle(eventsDates);
  createMatch();
}

// Init on load
window.addEventListener('load', ()=>{
  createMatch();
});
</script>

<!-- ===== Tracking des visiteurs ===== -->
<script>
fetch("/api/track.php")
    .then(res => res.json())
    .then(data => console.log("Visiteur trac√© :", data));
</script>

</body>
</html>
